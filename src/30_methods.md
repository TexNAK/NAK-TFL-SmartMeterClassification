# Houshold data collection

## Methodology

In order to evaluated which appliances might be recognizable, a data source is required. For this research paper, the household of the author will be used. It is a house with two floors, three bathrooms, two bedrooms and one living room. There are two inhabitants (including the author) where one is out for work from roughly 8am to 2pm, while the other stays at home working remotely. Notable appliances include an electric water heater in all bathrooms, a large TV set and an attached AV Receiver, and that most light fixtures are using halogen bulbs instead of LED ones.

The household has a central, accessible power meter which has been installed by the local electricity provider. It has been manufactured by EMH metering and is the model ITZ. Due to the technical knowledge required, the installation of a in-circuit meter is not viable. It would also incur significant up-front costs. For this reason, harmonics and waveform distortions will not be measured. The voltage-current trajectory and reactive power are also unavailable for the same reason^[Private households are usually not billed for reactive power and thus it is not measured by most meters]. The meter provided by the electricity provider does capture voltage and current across all three phases.

To access the data recorded by the meter an interface is required. The model present does have two serial interfaces according to the manufacturer. One uses the RS232 standard and communicates through a copper wire. The connector for this port is located below the cover of the unit which has been locked by the provider. For this reason, the second interface will be used. It is an optical port on the front of the unit. The timings are standardised by standard EN 62053-31, the protocol is defined in EN 62056-21:2002 and the optical wavelengths are specified by IEC 65056-21.

Communicating through the optical interface requires a unit which magnetically attaches to the port and contains a phototransistor for incoming communication and an infrared emitter for outgoing communication. For this experiment, a Osram SFH309FA-3/4 T1 phototransistor and an IRL81A infrared emitter by the same company will be used which both operate at or around a 880nm wavelength. They will be attached to a 3D printed housing using hot-glue and this housing will then be secured on the front panel through common household magnets. The wiring diagram can be seen in [@fig:wiring] and has been adopted from a blog at [404.at](https://blog.404.at/zaehlerwerte-vom-stromzaehler-ueber-d0-schnittstelle-iec-62056-21-auslesen/). While the diagram shows a Raspberry Pi as the microcontroller driving the interface, other MCUs can be used as well. During the development of the interface, an Arduino Mega and an Espressif ESP32 have been used. It is noteworthy however, that the polarity of the interface was reversed and in order for the hardware serial chips to decode the data, a logic inverter using two BC547 transistors had to be inserted.

![Optical interface wiring diagram](src/images/schematic.png){ width=65% #fig:wiring }

Once the interface was operational, serial communication had to be established. Some meters do passively broadcast their data at a fixed baudrate without a handshake. This model does require an explicit request. According to EN 62056-21:2002 the communication begins with a handshake at a baudrate of 300 with 7 data bits, even parity and one stop bit. The handshake must contain a meter-identification code which matches a hardcoded value. In this case, that value was encoded in a barcode on the front of the unit. Upon receipt of the handshake, the unit sends out an acknowledgement containing the new communication baudrate. According to the standard, this will be the minimum of the baudrate stated in the handshake and that is supported by the meter. However, changing the maximum supported baudrate in the handshake did not yield an increase in communication speed for unknown reasons. Thus, this interface is constrained to 300 bits per second which translates to a sample every 95 seconds. Since most transient state signatures are shorter than this, they will not be considered.

The final interface was built using an inexpensive, WiFi capable ESP32 MCU by Espressif (in this case the development board). It communicates with the meter at the fastest possible rate and stores the latest sample in memory. An HTTP endpoint is then provided which serves this data in a standardised format which adheres to the Prometheus data model^[https://prometheus.io/docs/concepts/data_model/] to increase interoperability with existing tools. An example of the data returned can be found in the appendix [@sec:example-data].

Since the MCU has no meaningful persistent storage, the samples have to be accessed from and stored elsewhere. In order to achieve this, the NAS server of the household will be running a simple bash script which will retrieve the current sample using the `curl` command-line tool and append the output to a text file with a timestamp and separator. This script will be executed every 95 seconds through a cronjob.

After two weeks of capturing, the text file will be retrieved and parsed into a simple data structure using Swift. Since the interface does not verify the checksum of the data received for simplicity reasons, the only safe-guard is the parity bit. This results in some damaged samples which will be filtered out during this stage. Any samples which are missing fields, contain invalid characters in the numeric fields, or have values that are unreasonable (current on a single phase above 80A) will be discarded. The remaining data is then reformatted into a comma separated list containing timestamped current and voltage values for each phase. To evaluate the data, it will be plotted using the `plotly` python library which allows the easy creation of interactive graphs. Excerpts from the full graph are then exported using the built-in snapshot feature.

The source code for all processing steps as well as the collected data samples are available in the accompanying GitHub repository^[Link is excluded in this version of the document].

To identify individual appliances, the graph will be searched for distinct power signatures without any contextual knowledge about the circumstances. No record of past events in the household is kept and a distance of two weeks between capture and evaluation is kept to remain as unbiased as possible. The power signatures will then be analysed based on their shape and characteristics to determine a list of potential appliances that could have caused it. Matching appliances will then be turned on during a time where there is minimal interference from other devices (e.g. when nobody else is home or late during the night) and the power signatures will be recorded. They will then be used to verify the assumptions made about the original power signatures.

## Analysis

This section contains four different distinct power signatures which have been captured. Note that some of the verification signatures do contain a few invalid samples which passed the syntax and plausability analysis. As the interface was in operation for a prolonged time period, more and more invalid samples accumulated. It is unclear how exactly this happened but a memory leak in the MCU or a deteriorating physical connection / increasing misalignment of the interface are strong suspects.
